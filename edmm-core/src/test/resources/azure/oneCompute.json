{
  "contentVersion" : "1.0.0.0",
  "parameters" : { },
  "variables" : { },
  "resources" : [ {
    "apiVersion" : "2019-04-01",
    "type" : "Microsoft.Network/virtualNetworks",
    "name" : "[variables('vnet_name')]",
    "location" : "[parameters('location')]",
    "properties" : {
      "addressSpace" : {
        "addressPrefixes" : [ "[parameters('vnetAddressSpace')]" ]
      },
      "subnets" : [ {
        "type" : "Microsoft.Network/virtualNetworks/subnets",
        "name" : "Subnet-1",
        "location" : "[parameters('location')]",
        "properties" : {
          "addressPrefix" : "[parameters('subnet_addressPrefix')]"
        }
      } ]
    }
  }, {
    "apiVersion" : "2019-04-01",
    "type" : "Microsoft.Storage/storageAccounts",
    "name" : "[parameters('storageAccountName')]",
    "location" : "[parameters('location')]",
    "properties" : { },
    "kind" : "Storage",
    "sku" : "Standard_LRS"
  }, {
    "apiVersion" : "2019-03-01",
    "type" : "Microsoft.Compute/virtualMachines",
    "name" : "vm_pet_clinic_ubuntu",
    "location" : "[parameters('location')]",
    "dependsOn" : [ "[concat('Microsoft.Storage/storageAccounts/', parameters('storageAccountName'))]", "[concat('Microsoft.Network/virtualNetworks/', variables('vnet_name'))]" ],
    "properties" : {
      "hardwareProfile" : {
        "vmSize" : "Standard_A0"
      },
      "osProfile" : {
        "computerName" : "[parameters('vm_pet_clinic_ubuntu_computerName')]",
        "adminUsername" : "[parameters('vm_pet_clinic_ubuntu_adminUserName')]",
        "linuxConfiguration" : {
          "disablePasswordAuthentication" : true,
          "ssh" : {
            "publicKeys" : [ {
              "path" : "[concat('/home/', parameters('vm_pet_clinic_ubuntu_adminUserName'), '/.ssh/authorized_keys')]",
              "keyData" : "-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCqGKukO1De7zhZj6+H0qtjTkVxwTCpvKe4eCZ0\nFPqri0cb2JZfXJ/DgYSF6vUpwmJG8wVQZKjeGcjDOL5UlsuusFncCzWBQ7RKNUSesmQRMSGkVb1/\n3j+skZ6UtW+5u09lHNsj6tQ51s1SPrCBkedbNf0Tp0GbMJDyR4e9T04ZZwIDAQAB\n-----END PUBLIC KEY-----\n"
            } ]
          }
        }
      },
      "storageProfile" : {
        "imageReference" : {
          "publisher" : "Canonical",
          "offer" : "UbuntuServer",
          "sku" : "14.04.5-LTS"
        },
        "osDisk" : {
          "name" : "vm_pet_clinic_ubuntu_OSDisk",
          "caching" : "ReadWrite",
          "createOptions" : "FromImage"
        }
      },
      "networkProfile" : {
        "networkInterfaces" : [ {
          "apiVersion" : "2019-04-01",
          "type" : "Microsoft.Network/networkInterfaces",
          "name" : "vm_pet_clinic_ubuntu_networkInterface",
          "location" : "[parameters('location')]",
          "properties" : {
            "networkSecurityGroup" : {
              "apiVersion" : "2019-04-01",
              "type" : "Microsoft.Network/networkSecurityGroups",
              "name" : "vm_pet_clinic_ubuntu_networkInterface_securityGroup",
              "location" : "[parameters('location')]",
              "properties" : {
                "securityRules" : [ ]
              }
            },
            "ipConfiguration" : {
              "name" : "vm_pet_clinic_ubuntu_networkInterface_ipConfiguration",
              "properties" : {
                "privateIpAllocationMethod" : "Dynamic",
                "publicIpAddress" : {
                  "apiVersion" : "2019-04-01",
                  "type" : "Microsoft.Network/publicIPAddresses",
                  "name" : "vm_pet_clinic_ubuntu_networkInterface_publicIpAddress",
                  "location" : "[parameters('location')]",
                  "properties" : {
                    "publicIpAllocationMethod" : "Dynamic",
                    "dnsSettings" : {
                      "domainNameLabel" : "[parameters('DnsName')]"
                    }
                  }
                },
                "subnet" : {
                  "id" : "[variables('subnet_id')]"
                }
              }
            }
          }
        } ]
      }
    }
  }, {
    "apiVersion" : "2019-03-01",
    "type" : "Microsoft.Compute/virtualMachines/extensions",
    "name" : "vm_pet_clinic_ubuntu_extension_configure_configure",
    "location" : "[parameters('location')]",
    "dependsOn" : [ "Microsoft.Compute/virtualMachines/vm_pet_clinic_ubuntu" ],
    "properties" : {
      "publisher" : "Microsoft.Azure.Extensions",
      "type" : "CustomScript",
      "typeHandlerVersion" : "2.0",
      "autoUpgradeMinorVersion" : true,
      "settings" : {
        "fileUrls" : [ "./ubuntu/configure.sh" ],
        "commandToExecute" : "'sh ./ubuntu/configure.sh'"
      }
    }
  } ]
}